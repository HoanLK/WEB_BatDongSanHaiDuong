(function(n){"use strict";function t(n,t,i,r,u,f,e,o,s){function c(){l()}function l(){o.GetListViewModel("select").then(function(t){n.categoryPosts=angular.copy(u.GenMultiLevel(t.data))},function(){toastr.error("Không lấy được Danh sách danh mục")})}n.page={title:"Danh sách Bài viết"};n.posts=[];n.post={};n.selectedPosts=[];n.categoryPosts=[];n.deletePost={status:!1,title:"Bạn có chắc chắn muốn xóa?",popup:{width:"auto",height:"auto",contentTemplate:"templateDeletePost",showTitle:!1,bindingOptions:{visible:"deletePost.status"}}};n.gridPosts=angular.copy(f.DefaultGrid);n.gridPosts.onInitialized=function(t){n.gridPostsInstance=t.component};n.gridPosts.dataSource=DevExpress.data.AspNet.createStore({key:"Id",loadUrl:"api/PostAPI"});n.gridPosts.bindingOptions={"columns[5].lookup.dataSource":"categoryPosts"};n.gridPosts.columns=[{caption:"ID",dataField:"Id",minWidth:60},{caption:"Trạng thái",dataField:"Published",cellTemplate:"publishedCellTemplate",trueText:"Xuất bản",falseText:"Chưa xuất bản",minWidth:90},{caption:"Nổi bật",dataField:"Featured",cellTemplate:"featuredCellTemplate",trueText:"Có",falseText:"Không",minWidth:90},{caption:"Tiêu đề",dataField:"Title",dataType:"string",minWidth:150},{caption:"Alias",dataField:"Alias",dataType:"string",visible:!1,minWidth:150},{caption:"Danh mục",dataField:"CategoryId",lookup:{displayExpr:"Title",valueExpr:"Id"},minWidth:100},{alignment:"left",caption:"Ngày tạo",dataField:"TimeCreated",dataType:"date",format:"dd/MM/yyyy",customizeText:function(n){return n.valueText},minWidth:100},{alignment:"center",caption:"Lượt xem",dataField:"Views",cellTemplate:"viewsCellTemplate",minWidth:90},{alignment:"left",caption:"Ghi chú",dataField:"Note",dataType:"string",visible:!1,minWidth:100}];n.gridPosts.export={allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Bài viết",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}};n.gridPosts.headerFilter.visible=!1;n.gridPosts.summary={texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"Id",summaryType:"count"}],totalItems:[{column:"Id",summaryType:"count"}]};n.gridPosts.onToolbarPreparing=function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.Create()}}},{location:"before",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.Edit()}}},{location:"before",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.Delete()}}})};n.gridPosts.onRowClick=function(t){var i=t.component,r;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount===1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount===2&&(r=new Date,r-i.lastClickTime<300&&(n.post=angular.copy(t.data),n.Edit()),i.clickCount=0,i.lastClickTime=0)};n.gridPosts.onSelectionChanged=function(t){n.selectedPosts=angular.copy(t.selectedRowsData)};var h=angular.copy(f.DefaultContextMenuGrid);n.contextMenuPost={dataSource:h,width:100,target:"#post",itemTemplate:angular.copy(f.TemplateContextMenuGrid),onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.Create();break;case"edit":n.Edit();break;case"delete":n.Delete()}}};c();n.Create=function(){s.RedirectCreate()};n.Edit=function(){n.selectedPosts.length===0?toastr.error("Chọn 1 dòng để sửa"):(n.post=angular.copy(n.selectedPosts[0]),s.RedirectEdit(n.post.Id))};n.Delete=function(){n.selectedPosts.length===0?toastr.error("Chọn dòng để xóa"):n.deletePost.status=!0};n.ConfirmDelete=function(){var t=r.GetArrayIds(n.selectedPosts);s.DeleteList(t).then(function(){n.gridPostsInstance.refresh();n.deletePost.status=!1;toastr.success("Xóa thành công")},function(){toastr.error("Không thể xóa")})};n.CancelDelete=function(){n.deletePost.status=!1}}n.controller("listPostController",t);t.$inject=["$scope","$http","$window","ArrayService","CommonService","DevExtremeService","StringService","CategoryPostService","PostService"]})(angular.module("backend"));