(function(n){"use strict";function t(n,t,i,r,u,f,e,o){function a(){v();h()}function v(){f.Get(c+"?viewmodel=true&&type=select").then(function(t){n.categoryPosts=angular.copy(f.GenMultiLevel(t.data))},function(){toastr.error("Không lấy được Danh sách danh mục")})}function h(){f.Get(s+"?viewmodel=true&&type=table").then(function(t){n.posts=angular.copy(t.data)},function(){toastr.error("Không lấy được Danh sách bài viết")})}function y(){n.filter=!n.filter}var s,c,l;n.page={title:"Danh sách Bài viết"};n.filter=!1;n.filterPost={Published:1};n.posts=[];n.tempPosts=[];n.post={};n.selectedPosts=[];s="/API/PostAPI";n.categoryPosts=[];c="/API/CategoryPostAPI";n.status=[{text:"-- Tất cả --",value:null},{text:"Xuất bản",value:!0},{text:"Chưa xuất bản",value:!1}];n.deletePost={status:!1,title:"Bạn có chắc chắn muốn xóa?",popup:{width:"auto",height:"auto",contentTemplate:"templateDeletePost",showTitle:!1,bindingOptions:{visible:"deletePost.status"}}};n.controlFilter={Published:{displayExpr:"text",valueExpr:"value",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"status",value:"filterPost.Published"}},StartDate:{type:"date",displayFormat:"dd/MM/yyyy",bindingOptions:{value:"filterPost.StartDate"}},EndDate:{type:"date",displayFormat:"dd/MM/yyyy",bindingOptions:{value:"filterPost.EndDate"}}};n.gridPosts=angular.copy(o.DefaultGrid);n.gridPosts.bindingOptions={dataSource:"posts","columns[5].lookup.dataSource":"categoryPosts","filterRow.visible":"filter"};n.gridPosts.columns=[{caption:"ID",dataField:"Id",width:90},{caption:"Trạng thái",dataField:"Published",cellTemplate:"publishedCellTemplate",width:90},{caption:"Nổi bật",dataField:"Featured",cellTemplate:"featuredCellTemplate",width:90},{caption:"Tiêu đề",dataField:"Title",dataType:"string"},{caption:"Alias",dataField:"Alias",dataType:"string",visible:!1},{caption:"Danh mục",dataField:"CategoryId",lookup:{displayExpr:"Title",valueExpr:"Id"}},{alignment:"left",caption:"Ngày tạo",dataField:"TimeCreated",dataType:"date",format:"dd/MM/yyyy",customizeText:function(n){return n.valueText},width:100},{alignment:"center",caption:"Lượt xem",dataField:"Views",cellTemplate:"viewsCellTemplate",width:90},{alignment:"left",caption:"Ghi chú",dataField:"Note",dataType:"string",visible:!1}];n.gridPosts.export={allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Danh mục bài viết",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}};n.gridPosts.headerFilter.visible=!1;n.gridPosts.summary={texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"Id",summaryType:"count"}],totalItems:[{column:"Id",summaryType:"count"}]};n.gridPosts.onToolbarPreparing=function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.Create()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.Edit()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.Delete()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){h()}}},{location:"after",widget:"dxButton",options:{hint:"Lọc dữ liệu",icon:"filter",onClick:function(){y()}}})};n.gridPosts.onRowClick=function(t){var i=t.component,r;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount===1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount===2&&(r=new Date,r-i.lastClickTime<300&&(n.post=angular.copy(t.data),n.Edit()),i.clickCount=0,i.lastClickTime=0)};n.gridPosts.onSelectionChanged=function(t){n.selectedPosts=angular.copy(t.selectedRowsData)};l=angular.copy(o.DefaultContextMenuGrid);n.contextMenuPost={dataSource:l,width:100,target:"#post",itemTemplate:angular.copy(o.TemplateContextMenuGrid),onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.Create();break;case"edit":n.Edit();break;case"delete":n.Delete()}}};a();n.GetPosts=function(){n.filterPost.StartDate=new Date(n.filterPost.StartDate).toUTCString();n.filterPost.EndDate=new Date(n.filterPost.EndDate).toUTCString();n.filterPost.ViewModel=!0;n.filterPost.Type="table";f.Get(s+"?filter="+n.filterPost).then(function(n){console.log(n.data)},function(){toastr.error("Không lấy được Danh sách bài viết")})};n.Create=function(){i.location.href="/Admin#!/post/edit"};n.Edit=function(){n.selectedPosts.length===0?toastr.error("Chọn 1 dòng để sửa"):(n.post=angular.copy(n.selectedPosts[0]),i.location.href="/Admin#!/post/edit/"+n.post.Id)};n.Delete=function(){n.selectedPosts.length===0?toastr.error("Chọn dòng để xóa"):n.deletePost.status=!0};n.ConfirmDelete=function(){var t=u.GetArrayIds(n.selectedPosts);f.DeleteList(s,t).then(function(t){t.data===1?(h(),n.deletePost.status=!1,toastr.success("Xóa thành công")):toastr.error("Không thể xóa")},function(){toastr.error("Không thể xóa")})};n.CancelDelete=function(){n.deletePost.status=!1}}n.controller("listPostController",t);t.$inject=["$scope","$http","$window","$cookies","ArrayService","CRUDService","DateTimeService","DevExtremeService","StringService"]})(angular.module("backend"));