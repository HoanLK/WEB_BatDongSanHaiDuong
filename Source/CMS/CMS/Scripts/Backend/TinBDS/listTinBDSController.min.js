backend.controller("listTinBDSController",["$scope","$http","$window","$cookies","Services",function(n,t,i,r,u){function h(){c();e()}function c(){u.Get(o+"?viewmodel=true&&type=select").then(function(t){n.categoryProjects=angular.copy(u.GenMultiLevel(t.data))},function(){toastr.error("Không lấy được Danh sách danh mục")})}function e(){u.Get(f+"?viewmodel=true&&type=table").then(function(t){n.projects=angular.copy(t.data)},function(){toastr.error("Không lấy được Danh sách Dự án")})}function l(){n.filter=!n.filter}var f,o,s;n.page={title:"Danh sách Tin Bất động sản"};n.filter=!1;n.projects=[];n.tempProjects=[];n.project={};n.selectedProjects=[];f="/API/ProjectAPI";n.categoryProjects=[];o="/API/CategoryProjectAPI";n.deleteProject=!1;n.titleDeleteProject="Bạn có chắc chắn muốn xóa?";n.popupDeleteProject={width:"auto",height:"auto",contentTemplate:"templateDeleteProject",showTitle:!1,bindingOptions:{visible:"deleteProject"}};n.gridProjects={bindingOptions:{dataSource:"projects","columns[6].lookup.dataSource":"categoryProjects","filterRow.visible":"filter"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columnResizingMode:"widget",columns:[{caption:"ID",dataField:"Id",visible:!1,width:90},{caption:"Trạng thái",dataField:"Published",cellTemplate:"publishedCellTemplate",width:90},{caption:"Nổi bật",dataField:"Featured",cellTemplate:"featuredCellTemplate",width:90},{caption:"Tiêu đề",dataField:"Title",dataType:"string"},{caption:"Alias",dataField:"Alias",dataType:"string",visible:!1},{caption:"Mức giá",dataField:"MucGia",dataType:"string"},{caption:"Danh mục",dataField:"CategoryId",lookup:{displayExpr:"Title",valueExpr:"Id"}},{alignment:"left",caption:"Ngày tạo",dataField:"TimeCreated",dataType:"date",format:"dd/MM/yyyy",customizeText:function(n){return n.valueText},width:100},{alignment:"center",caption:"Lượt xem",dataField:"Views",cellTemplate:"viewsCellTemplate",width:90},{alignment:"left",caption:"Ghi chú",dataField:"Note",dataType:"string",visible:!1}],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Danh mục Dự án",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)"},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!1},height:"100%",hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.Create()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.Edit()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.Delete()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){e()}}},{location:"after",widget:"dxButton",options:{hint:"Lọc dữ liệu",icon:"filter",onClick:function(){l()}}})},onRowClick:function(t){var i=t.component,r,u;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount===1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount===2&&(r=new Date,u=r-i.lastClickTime,u<300&&(n.project=angular.copy(t.data),n.Edit()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedProjects=angular.copy(t.selectedRowsData)}};s=[{value:"add",text:" Thêm",icon:"fa fa-plus"},{value:"edit",text:" Sửa",icon:"fa fa-pencil"},{value:"delete",text:" Xóa",icon:"fa fa-times"}];n.contextMenuProject={dataSource:s,width:100,target:"#project",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.Create();break;case"edit":n.Edit();break;case"delete":n.Delete()}}};h();n.Create=function(){i.location.href="/Admin#!/project/edit"};n.Edit=function(){n.selectedProjects.length===0?toastr.error("Chọn 1 dòng để sửa"):(n.project=angular.copy(n.selectedProjects[0]),i.location.href="/Admin#!/project/edit/"+n.project.Id)};n.Delete=function(){n.selectedProjects.length===0?toastr.error("Chọn dòng để xóa"):n.deleteProject=!0};n.ConfirmDelete=function(){var t="";angular.forEach(n.selectedProjects,function(i,r){t+=r!==n.selectedProjects.length-1?i.Id+",":i.Id});u.DeleteList(f,t).then(function(t){t.data===1?(e(),n.deleteProject=!1,toastr.success("Xóa thành công")):toastr.error("Không thể xóa")},function(){toastr.error("Không thể xóa")})};n.CancelDelete=function(){n.deleteProject=!1}}]);