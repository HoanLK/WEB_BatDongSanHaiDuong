backend.controller("editVideoController",["$scope","$http","$window","$cookies","$routeParams","$sce","Services",function(n,t,i,r,u,f,e){function s(){n.id=u.id;e.CheckNull(n.id)?(n.page.title="Sửa video",c(n.id)):(n.page.title="Thêm video",h());e.GetCurrentAccount().then(function(t){n.video.UserId=t.data.Id})}function h(){n.video={Published:!0,TimeCreated:e.ToUTCDate(new Date),Views:0}}function c(t){e.Get(o+"/"+t).then(function(t){n.video=angular.copy(t.data)},function(){toastr.error("Không tìm thấy Videp");i.location.href="/Admin#!/video"})}function l(){var t=0;return angular.forEach(n.valid,function(n,i){if(!n){switch(i){case"Title":toastr.error("Nhập Tiêu đề");break;case"Alias":toastr.error("Nhập Alias");break;case"VideoUrl":toastr.error("Nhập Link video")}t++}}),t===0?!0:!1}n.page={};n.videos=[];n.tempVideos=[];n.video={};n.selectedVideos=[];var o="/API/VideoAPI";n.valid={Title:!1,Alias:!1,VideoUrl:!1};n.statuses=[{text:"Xuất bản",value:!0},{text:"Không xuất bản",value:!1}];s();n.Save=function(t){l()&&(e.CheckNull(n.id)?e.Edit(o,n.video.Id,n.video).then(function(){toastr.success("Lưu thành công");switch(t){case"Edit":s();break;case"New":i.location.href="/Admin#!/video/edit";break;case"Exit":i.location.href="/Admin#!/video"}},function(){toastr.error("Lưu thất bại")}):e.Create(o,n.video).then(function(n){toastr.success("Thêm thành công");switch(t){case"Edit":i.location.href="/Admin#!/video/edit/"+n.data.Id;break;case"New":s();break;case"Exit":i.location.href="/Admin#!/video"}},function(){toastr.error("Thêm thất bại")}))};n.Cancel=function(){i.location.href="/Admin#!/video"};n.tab=1;n.SetTab=function(t){n.tab=t};n.IsSet=function(t){return n.tab===t};n.GenAlias=function(){n.valid.Title?n.video.Alias=e.GenAlias(n.video.Title):toastr.error("Vui lòng nhập Tiêu đề")};n.ChooseImage=function(){var t=new CKFinder;t.selectActionFunction=function(t){n.video.Image=t;n.$apply()};t.SelectFunction="ShowFileInfo";t.popup()};n.CheckNullTitle=function(){return e.CheckNull(n.video.Title)?(n.valid.Title=!0,!0):(n.valid.Title=!1,!1)};n.CheckNullAlias=function(){return e.CheckNull(n.video.Alias)?(n.valid.Alias=!0,!0):(n.valid.Alias=!1,!1)};n.CheckNullVideoUrl=function(){return e.CheckNull(n.video.VideoUrl)?(n.valid.VideoUrl=!0,!0):(n.valid.VideoUrl=!1,!1)}}]);